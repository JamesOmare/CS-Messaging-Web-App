{% extends 'base.html' %}

{% block title %}
<span>Branch Help Center</span>
{% endblock title %}


{% block content %}


<section class="bg-white dark:bg-gray-900">
    <div class="py-8 px-4 mx-auto max-w-screen-xl lg:py-16">
        <div class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-8 md:p-12 mb-0">
            
              
            <div class="flex">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.05 4.575a1.575 1.575 0 10-3.15 0v3m3.15-3v-1.5a1.575 1.575 0 013.15 0v1.5m-3.15 0l.075 5.925m3.075.75V4.575m0 0a1.575 1.575 0 013.15 0V15M6.9 7.575a1.575 1.575 0 10-3.15 0v8.175a6.75 6.75 0 006.75 6.75h2.018a5.25 5.25 0 003.712-1.538l1.732-1.732a5.25 5.25 0 001.538-3.712l.003-2.024a.668.668 0 01.198-.471 1.575 1.575 0 10-2.228-2.228 3.818 3.818 0 00-1.12 2.687M6.9 7.575V12m6.27 4.318A4.49 4.49 0 0116.35 15m.002 0h-.002" />
                  </svg>
                  <h1 class="text-gray-900 dark:text-white text-2xl md:text-5xl font-extrabold mb-2">
                    Hello {{ current_user.user_name | title}}
                </h1>
            </div>
            
            <p class="text-lg font-normal text-gray-500 dark:text-gray-400 mb-6">This is where you can send your complaints or enquiries to our support staff.</p>
            
        </div>
    </div>
</section>


<!-- Section 2 -->
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet" />
<style>
* {
font-family: 'Source Sans Pro'; 
} 
</style>
<section class="shadow-blue-100 mx-auto max-w-screen-lg rounded-xl bg-white text-gray-600 shadow-lg sm:my-4 sm:border">
<div class="container mx-auto flex flex-col flex-wrap px-5 pb-12">
    <div class="bg-slate-50 mx-auto mt-4 mb-4 flex w-full flex-wrap items-center space-x-4 py-4 md:mb-4 md:justify-center md:px-10">
    <span class="text-teal-500 text-3xl md:text-5xl font-extrabold  md:inline">Submit an Inquery</span>
    </div>

    <div class="flex w-full flex-col">
        <form method="POST" action="{{ url_for('main.send_message') }}">
            <div class="">
                <div class="mx-auto max-w-screen-sm px-4">
                <h1 class="mt-6 text-xl font-bold sm:mb-6 sm:text-3xl">Our Support Staff Will Get To You Shortly</h1>
            
                <div class="-ml-20 flex p-4 text-left text-gray-700">
                    <img class="mr-5 h-12 w-12 rounded-full" src="https://ui-avatars.com/api/?name={{current_user.user_name}}" alt="" />
                    <div class="w-full space-y-3 text-gray-700">

                    <div class="">
                        <label for="reason" class="flex w-full cursor-pointer select-none  p-2 px-3 text-lg text-gray-700" >How can we assist you?</label>
                    </div>

                    <!-- Dropdown Area -->
                    <div class="">
                        <div class="relative w-full">
                            <input class="peer hidden" type="checkbox" name="select_option" id="select_option" />
                            <label for="select_option" id="selected-option-label" class="flex h-12 w-full cursor-pointer select-none rounded-lg border p-2 px-3 text-lg text-gray-700 ring-blue-400 peer-checked:ring">Question About</label>

                            <!-- <label for="select_option" class="flex w-full cursor-pointer select-none rounded-lg border p-2 px-3 text-sm text-gray-700 ring-blue-400 peer-checked:ring">Users To Receive Email</label> -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="pointer-events-none absolute right-0 top-3 ml-auto mr-5 h-4 text-gray-600 transition peer-checked:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                            </svg>
                            <ul class="max-h-0 select-none flex-col overflow-hidden rounded-b-lg shadow-xl transition-all duration-300 peer-checked:max-h-56 peer-checked:py-3">
                                <li class="cursor-pointer px-3 py-2 text-md text-gray-500 hover:bg-blue-500 hover:text-white" onclick="updateSelectedOption('Loan Application')">Loan Application</li>
                                <li class="cursor-pointer px-3 py-2 text-md text-gray-500 hover:bg-blue-500 hover:text-white" onclick="updateSelectedOption('Payment Enquiries')">Payment Enquiries</li>
                                <li class="cursor-pointer px-3 py-2 text-md text-gray-500 hover:bg-blue-500 hover:text-white" onclick="updateSelectedOption('Interest Rate and Terms')">Interest Rate and Terms</li>
                                <li class="cursor-pointer px-3 py-2 text-md text-gray-500 hover:bg-blue-500 hover:text-white" onclick="updateSelectedOption('Account and Personal Information Update')">Account and Personal Information Update</li>
                                <li class="cursor-pointer px-3 py-2 text-md text-gray-500 hover:bg-blue-500 hover:text-white" onclick="updateSelectedOption('Other')">Other</li>
                            </ul>
                        </div>
                    </div>
                
                    <!-- Display the selected option -->
                    <div id="selected-option" class="text-gray-700 mt-2"></div>
                    

                    <!-- Text Area -->
                    <div class="w-full mb-4 border border-gray-200 rounded-lg bg-gray-50 dark:bg-gray-700 dark:border-gray-600">
                            <div class="">
                                <textarea name="comment" id="" placeholder="Enter the specific details of your inquiry." cols="30" rows="6" class="h-40 w-full min-w-full max-w-full overflow-auto whitespace-pre-wrap rounded-md border bg-white p-5 text-sm font-normal normal-case text-gray-600 opacity-100 outline-none focus:text-gray-600 focus:opacity-100 focus:ring"></textarea>
                            </div>
                            <!-- text area bottom div -->
                            <div class="flex items-center justify-between px-3 py-2 border-t dark:border-gray-600">
                                <div class="flex pl-0 space-x-1 sm:pl-2">
                                    
                                </div>
                            </div>
                    </div>


                    </div>
                </div>

                <!-- Hidden input to store the selected option -->
                <input type="hidden" name="selected_option" id="selected_option" value="">

                <!-- Hidden input to store the user_id -->
                <input type="hidden" name="user_id" value="{{ current_user.id }}">

                <button type="submit" class="group flex cursor-pointer items-center rounded-xl bg-blue-600 bg-none px-8 py-4 text-center font-semibold leading-tight text-white">
                    Send
                    <svg class="group-hover:ml-8 ml-4 transition-all" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.912 12H4L2.023 4.135A.662.662 0 0 1 2 3.995c-.022-.721.772-1.221 1.46-.891L22 12L3.46 20.896c-.68.327-1.464-.159-1.46-.867a.66.66 0 0 1 .033-.186L3.5 15" /></svg>
                </button>
                </div>
            </div>
            
        </form>
    </div>
</div>
</section>

<section class="shadow-blue-100 mx-auto max-w-screen-lg rounded-xl bg-white text-gray-600 shadow-lg sm:my-4 sm:border">
    <div class="container mx-auto flex flex-col flex-wrap px-5 pb-12">
        <div class="bg-slate-50 mx-auto mt-4 mb-4 flex w-full flex-wrap items-center space-x-4 py-4 md:mb-4 md:justify-center md:px-10">
        <span class="text-orange-500 text-3xl md:text-5xl font-extrabold  md:inline">My Queries</span>
        </div>
    
        <div class="flex w-full flex-col">
            <div class="">
                <div class="mx-auto w-full px-4">
                <h1 class="mt-6 text-xl font-bold sm:mb-6 sm:text-3xl text-center">Here Are Your Submitted Queries:</h1>
                {% if messages %}
                    {% for message in messages %}
                    <div class="mx-auto my-10 max-w-4xl rounded-xl border px-4 py-6 text-gray-700">
                        <div class="mb-5">
                          <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="h-7 w-7" viewBox="0 0 16 16">
                                <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zm8 0A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm-8 8A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm8 0A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3z"/>
                              </svg>
                            <p class="ml-4 w-56">
                              <strong class="block font-medium text-gray-700">Query #{{ loop.index }}</strong>
                              <span class="truncate text-sm text-gray-400">Submitted <span class="ml-2 mr-3 rounded-full bg-green-100 px-2 py-0.5 text-green-900"> {{  moment(message.created_at).fromNow(refresh=True) }} </span>
                              <span class="truncate text-sm text-gray-400">Status </span>
                                {% if message.status == "Pending" %}
                                    <span class="ml-2 mr-3 rounded-full bg-red-100 px-2 py-0.5 text-red-900">{{ message.status }}</span>

                                {% else %}
                                    <span class="ml-2 mr-3 rounded-full bg-blue-100 px-2 py-0.5 text-blue-900">{{ message.status }}</span>
                                {% endif %}
                                
                            </p>
                          </div>
                        </div>
                        <div class="mb-3">{{ message.text_query }}</div>
                        {% if message.status == "Resolved" %}
                          <div class="rounded-lg bg-gray-100 p-4">
                            <p class="mb-2 text-gray-500 text-sm border-b-2 border-gray-300 pb-1">Answered by Support Agent: <span class="ml-2 mr-3 rounded-full bg-teal-100 px-2 py-0.5 text-teal-900">{{ message.agent.user_name }}</span>  on: <span class="ml-2 mr-3 rounded-full bg-blue-100 px-2 py-0.5 text-blue-900">{{ moment(message.updated_at).format('LLL') }}</span></p>
                            <p class=""><span class="text-gray-500 text-sm">Reply: </span> {{ message.text_reply }}</p>
                          </div>
                        {% endif %}
                        
                        
                    </div>
                    {% endfor %}

                {% else %}

                <div class="bg-gray-100 py-10">
                    <div class="mx-auto flex w-72 flex-col items-center rounded-3xl border-4 bg-white px-6 py-8 text-center">
                      <div class="mb-6 text-5xl text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="1em" height="1em">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9.143 17.082a24.248 24.248 0 003.844.148m-3.844-.148a23.856 23.856 0 01-5.455-1.31 8.964 8.964 0 002.3-5.542m3.155 6.852a3 3 0 005.667 1.97m1.965-2.277L21 21m-4.225-4.225a23.81 23.81 0 003.536-1.003A8.967 8.967 0 0118 9.75V9A6 6 0 006.53 6.53m10.245 10.245L6.53 6.53M3 3l3.53 3.53" />
                        </svg>
                        
                      </div>
                      <p class="mb-2 text-xl font-medium text-gray-600">No Queries</p>
                      <p class="text-gray-500">You Have Not Posted Any Queries.</p>
                    </div>
                  </div>
                        
                {% endif %}
                
               
                
                
                  
                    
                </div>
            </div>
        </div>
    </div>
</section>


{% endblock content %}

{% block script %}



<script>
    function updateSelectedOption(optionText) {
        // Update the label's text with the selected option text
        document.getElementById('selected-option-label').textContent = 'Inquiry About - ' + optionText;

        // Update the hidden input value
        document.getElementById('selected_option').value = optionText;

        // Toggle the checkbox's state to collapse the dropdown
        var checkbox = document.getElementById('select_option');
        checkbox.checked = false;
    }
</script>


{% endblock script %}